<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>♟️ Chess Dashboard</title>

<!-- Chessboard CSS -->
<link rel="stylesheet"
 href="https://unpkg.com/chessboardjs@1.0.0-beta.6/dist/chessboard-1.0.0.min.css"/>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  text-align:center;
  margin:0;
  padding:0;
}
h2{ margin-top:10px; }
#dashboard{ margin-top:20px; }
#board{ width:320px; margin:20px auto; }
#status{ font-weight:bold; margin-top:10px; }
#timer{ margin-top:5px; }
button{
  padding:10px 20px;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>♟️ Chess Dashboard</h2>

<div id="dashboard">
  <button onclick="startSystemGame()">System Game | You vs Computer</button>
</div>

<div id="status">Ready</div>
<div id="timer"></div>
<div id="board"></div>

<!-- Firebase (compat – GitHub Pages safe) -->
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-database-compat.js"></script>

<!-- Chess libraries -->
<script src="https://unpkg.com/chess.js@1.0.0-beta.9/chess.js"></script>
<script src="https://unpkg.com/chessboardjs@1.0.0-beta.6/dist/chessboard-1.0.0.min.js"></script>

<script>
/* ================= Firebase ================= */
const firebaseConfig = {
  apiKey: "AIzaSyACIKwrp-KV6o2vRM6adXESjU1-OpbVscc",
  authDomain: "cess-cb730.firebaseapp.com",
  databaseURL: "https://cess-cb730-default-rtdb.firebaseio.com",
  projectId: "cess-cb730",
  storageBucket: "cess-cb730.firebasestorage.app",
  messagingSenderId: "324360812002",
  appId: "1:324360812002:web:6a9bedb2cfc67db41a75bb"
};

firebase.initializeApp(firebaseConfig);
firebase.auth().signInAnonymously().catch(()=>{});

/* ================= Chess ================= */
let game, board;
let whiteTime = 600, blackTime = 600;
let timerInterval;

function startSystemGame(){
  document.getElementById("dashboard").style.display="none";
  document.getElementById("status").innerText =
    "System Game | You vs Computer | Playing...";

  game = new Chess();

  board = Chessboard("board",{
    draggable:true,
    position:"start",
    orientation:"white",
    onDrop:onDrop
  });

  startTimer();
}

function onDrop(source,target){
  let move = game.move({from:source,to:target,promotion:"q"});
  if(move === null) return "snapback";

  updateStatus();
  setTimeout(systemMove,500);
}

function systemMove(){
  if(game.game_over()) return;
  let moves = game.moves();
  let move = moves[Math.floor(Math.random()*moves.length)];
  game.move(move);
  board.position(game.fen());
  updateStatus();
}

function updateStatus(){
  let moveColor = game.turn()==="w" ? "White" : "Black";
  if(game.in_checkmate()){
    document.getElementById("status").innerText =
      "Checkmate! " + (moveColor==="White"?"Black":"White") + " wins";
    clearInterval(timerInterval);
  }else if(game.in_draw()){
    document.getElementById("status").innerText="Draw!";
    clearInterval(timerInterval);
  }else{
    document.getElementById("status").innerText =
      "Playing... " + moveColor + " to move";
  }
}

function startTimer(){
  timerInterval = setInterval(()=>{
    if(game.turn()==="w") whiteTime--;
    else blackTime--;

    document.getElementById("timer").innerText =
      "White: "+fmt(whiteTime)+" | Black: "+fmt(blackTime);

    if(whiteTime<=0 || blackTime<=0){
      clearInterval(timerInterval);
      document.getElementById("status").innerText="Time Over!";
    }
  },1000);
}

function fmt(s){
  let m=Math.floor(s/60);
  let ss=s%60;
  return String(m).padStart(2,"0")+":"+String(ss).padStart(2,"0");
}
</script>

</body>
</html>
